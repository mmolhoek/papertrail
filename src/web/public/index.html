<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Papertrail - GPS Tracker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&family=DM+Mono:wght@400;500&family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/styles.css" />
    <!-- Leaflet CSS for drive navigation map -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
  </head>
  <body>
    <!-- Topographic Background Pattern -->
    <div class="topo-bg"></div>

    <div class="container">
      <!-- Header with Compass Rose -->
      <header class="header">
        <div class="compass-rose">
          <svg viewBox="0 0 100 100" class="compass-svg">
            <circle cx="50" cy="50" r="45" class="compass-outer" />
            <circle cx="50" cy="50" r="35" class="compass-inner" />
            <line x1="50" y1="5" x2="50" y2="20" class="compass-tick major" />
            <line x1="50" y1="80" x2="50" y2="95" class="compass-tick major" />
            <line x1="5" y1="50" x2="20" y2="50" class="compass-tick major" />
            <line x1="80" y1="50" x2="95" y2="50" class="compass-tick major" />
            <polygon points="50,15 45,45 50,40 55,45" class="compass-north" />
            <polygon points="50,85 45,55 50,60 55,55" class="compass-south" />
            <text x="50" y="12" class="compass-label">N</text>
          </svg>
        </div>
        <div class="header-text">
          <h1>Papertrail</h1>
          <p class="tagline">Expedition Command</p>
        </div>
      </header>

      <!-- Navigation Menu -->
      <nav class="nav-bar">
        <button id="menu-toggle" class="nav-toggle" aria-label="Menu">
          <span class="nav-icon"></span>
        </button>
        <div id="menu-content" class="nav-menu hidden">
          <button id="menu-status" class="nav-item" data-panel="status-panel">
            <span class="nav-item-icon">‚óé</span>
            <span class="nav-item-text">Status</span>
            <span id="status-indicator" class="nav-check hidden">‚úì</span>
          </button>
          <button
            id="menu-track-selection"
            class="nav-item active"
            data-panel="track-selection-panel"
          >
            <span class="nav-item-icon">‚óé</span>
            <span class="nav-item-text">Track</span>
            <span id="track-selection-indicator" class="nav-check">‚úì</span>
          </button>
          <button id="menu-drive" class="nav-item" data-panel="drive-panel">
            <span class="nav-item-icon">‚óé</span>
            <span class="nav-item-text">Drive</span>
            <span id="drive-indicator" class="nav-check hidden">‚úì</span>
          </button>
          <button
            id="menu-display-controls"
            class="nav-item"
            data-panel="display-controls-panel"
          >
            <span class="nav-item-icon">‚óé</span>
            <span class="nav-item-text">Display Controls</span>
            <span id="display-controls-indicator" class="nav-check hidden"
              >‚úì</span
            >
          </button>
          <button
            id="menu-wifi-settings"
            class="nav-item"
            data-panel="wifi-settings-panel"
          >
            <span class="nav-item-icon">‚óé</span>
            <span class="nav-item-text">WiFi Settings</span>
            <span id="wifi-settings-indicator" class="nav-check hidden">‚úì</span>
          </button>
          <button id="menu-reset" class="nav-item" data-panel="reset-panel">
            <span class="nav-item-icon">‚óé</span>
            <span class="nav-item-text">Reset</span>
            <span id="reset-indicator" class="nav-check hidden">‚úì</span>
          </button>
          <button
            id="menu-mock-display"
            class="nav-item"
            data-panel="mock-display-panel"
          >
            <span class="nav-item-icon">‚óé</span>
            <span class="nav-item-text">Mock Display</span>
            <span id="mock-display-indicator" class="nav-check hidden">‚úì</span>
          </button>
        </div>
      </nav>

      <main class="main-content">
        <!-- Status Panel - Combined Position and System Status -->
        <section
          class="unified-status-panel panel-card hidden"
          id="status-panel"
        >
          <div class="unified-status-header">
            <span class="unified-status-marker">STATUS</span>
            <div class="unified-status-indicator">
              <span class="pulse-dot" id="gps-pulse"></span>
              <span id="gps-status-mini">Acquiring</span>
            </div>
          </div>
          <div class="unified-status-grid">
            <div class="unified-status-row">
              <span class="unified-status-label">LAT</span>
              <span class="unified-status-value" id="latitude">--¬∞</span>
            </div>
            <div class="unified-status-row">
              <span class="unified-status-label">LON</span>
              <span class="unified-status-value" id="longitude">--¬∞</span>
            </div>
            <div class="unified-status-row">
              <span class="unified-status-label">ELEV</span>
              <span class="unified-status-value" id="altitude">--</span>
            </div>
            <div class="unified-status-row">
              <span class="unified-status-label">GPS</span>
              <span class="unified-status-value" id="gps-status">Unknown</span>
            </div>
            <div class="unified-status-row">
              <span class="unified-status-label">FIX</span>
              <span class="unified-status-value" id="gps-fix-status"
                >Unknown</span
              >
            </div>
            <div class="unified-status-row">
              <span class="unified-status-label">SATS</span>
              <span class="unified-status-value" id="satellites">0</span>
            </div>
            <div class="unified-status-row">
              <span class="unified-status-label">HDOP</span>
              <span class="unified-status-value" id="gps-hdop">--</span>
            </div>
            <div class="unified-status-row">
              <span class="unified-status-label">DISPLAY</span>
              <span class="unified-status-value" id="display-status"
                >Unknown</span
              >
            </div>
            <div class="unified-status-row">
              <span class="unified-status-label">TRACK</span>
              <span class="unified-status-value truncate" id="active-track"
                >None</span
              >
            </div>
          </div>
        </section>

        <!-- GPX Track Selection Panel -->
        <section class="panel-card" id="track-selection-panel">
          <div class="section-header">
            <span class="section-marker">TRACK SELECTION</span>
          </div>
          <div class="panel-content">
            <div class="select-wrapper">
              <select id="track-select" class="custom-select">
                <option value="">Select a track...</option>
              </select>
              <span class="select-arrow">‚ñæ</span>
            </div>
            <div class="track-actions">
              <button id="upload-track-btn" class="btn btn-secondary">
                <span class="btn-icon">+</span>
                Upload
              </button>
              <button id="delete-track-btn" class="btn btn-danger">
                <span class="btn-icon">√ó</span>
                Delete
              </button>
            </div>
            <div class="track-name-option">
              <label class="checkbox-label">
                <input type="checkbox" id="use-track-name" />
                <span>Use track name from GPX file</span>
              </label>
            </div>
            <input
              type="file"
              id="gpx-file-input"
              accept=".gpx"
              class="hidden"
            />
          </div>
          <div id="track-info" class="track-info hidden">
            <div class="track-stat">
              <span class="track-stat-label">Points</span>
              <span class="track-stat-value" id="track-points">0</span>
            </div>
            <div class="track-stat">
              <span class="track-stat-label">Distance</span>
              <span class="track-stat-value" id="track-distance">0 km</span>
            </div>
          </div>
          <!-- Simulation Controls (shown when track is loaded) -->
          <div id="simulation-controls" class="simulation-controls hidden">
            <div class="section-header simulation-section-header">
              <span class="section-marker">SIMULATE</span>
            </div>
            <div class="speed-selector">
              <label class="control-label">Simulation Speed</label>
              <div class="speed-buttons">
                <button
                  id="speed-walk"
                  class="speed-btn active"
                  data-speed="walk"
                >
                  <span class="speed-icon">üö∂</span>
                  <span class="speed-label">Walk</span>
                  <span class="speed-value">10 km/h</span>
                </button>
                <button
                  id="speed-bicycle"
                  class="speed-btn"
                  data-speed="bicycle"
                >
                  <span class="speed-icon">üö¥</span>
                  <span class="speed-label">Bicycle</span>
                  <span class="speed-value">30 km/h</span>
                </button>
                <button id="speed-drive" class="speed-btn" data-speed="drive">
                  <span class="speed-icon">üöó</span>
                  <span class="speed-label">Drive</span>
                  <span class="speed-value">100 km/h</span>
                </button>
              </div>
            </div>
            <div class="simulation-actions">
              <button
                id="start-simulation-btn"
                class="btn btn-primary btn-large"
              >
                <span class="btn-icon">‚ñ∂</span>
                <span class="btn-text">Start</span>
              </button>
              <button id="stop-simulation-btn" class="btn btn-danger hidden">
                <span class="btn-icon">‚ñ†</span>
                <span class="btn-text">Stop</span>
              </button>
              <button
                id="pause-simulation-btn"
                class="btn btn-secondary hidden"
              >
                <span class="btn-icon">‚è∏</span>
                <span class="btn-text">Pause</span>
              </button>
            </div>
            <div id="simulation-status" class="simulation-status hidden">
              <div class="sim-stat">
                <span class="sim-stat-label">Progress</span>
                <div class="progress-bar">
                  <div
                    id="sim-progress-bar"
                    class="progress-fill"
                    style="width: 0%"
                  ></div>
                </div>
                <span class="sim-stat-value" id="sim-progress">0%</span>
              </div>
              <div class="sim-stat">
                <span class="sim-stat-label">Remaining</span>
                <span class="sim-stat-value" id="sim-remaining">--</span>
              </div>
            </div>
          </div>
        </section>

        <!-- Drive Navigation Panel -->
        <section class="panel-card hidden" id="drive-panel">
          <div class="section-header">
            <span class="section-marker">DRIVE NAVIGATION</span>
          </div>
          <div class="panel-content">
            <!-- Destination Input Tabs -->
            <div class="drive-tabs">
              <button class="drive-tab active" data-tab="address">
                Address
              </button>
              <button class="drive-tab" data-tab="coords">Coordinates</button>
              <button class="drive-tab" data-tab="map">Map</button>
            </div>

            <!-- Address Search Tab -->
            <div id="drive-tab-address" class="drive-tab-content active">
              <div class="form-field">
                <label class="field-label">Search Address</label>
                <input
                  type="text"
                  id="drive-address-input"
                  class="field-input"
                  placeholder="Enter destination address..."
                />
                <div id="drive-address-results" class="address-results hidden">
                  <!-- Autocomplete results will be added here -->
                </div>
              </div>
            </div>

            <!-- Coordinates Tab -->
            <div id="drive-tab-coords" class="drive-tab-content hidden">
              <div class="coord-input-row">
                <div class="form-field">
                  <label class="field-label">Latitude</label>
                  <input
                    type="number"
                    id="drive-lat-input"
                    class="field-input"
                    placeholder="e.g. 52.5200"
                    step="0.0001"
                  />
                </div>
                <div class="form-field">
                  <label class="field-label">Longitude</label>
                  <input
                    type="number"
                    id="drive-lon-input"
                    class="field-input"
                    placeholder="e.g. 13.4050"
                    step="0.0001"
                  />
                </div>
              </div>
              <button
                id="drive-coords-apply"
                class="btn btn-secondary btn-full"
              >
                Apply Coordinates
              </button>
            </div>

            <!-- Map Tab -->
            <div id="drive-tab-map" class="drive-tab-content hidden">
              <div id="drive-map" class="drive-map">
                <p class="map-placeholder">Tap to select destination on map</p>
              </div>
            </div>

            <!-- Selected Destination Display -->
            <div id="drive-destination" class="drive-destination hidden">
              <span class="dest-label">Destination:</span>
              <span id="drive-dest-text" class="dest-text">--</span>
              <button id="drive-clear-dest" class="dest-clear">√ó</button>
            </div>

            <!-- Calculate Route Button -->
            <button
              id="drive-calc-route"
              class="btn btn-primary btn-large"
              disabled
            >
              <span class="btn-icon">‚ü≥</span>
              <span class="btn-text">Calculate Route</span>
            </button>

            <!-- Route Preview -->
            <div id="drive-route-preview" class="route-preview hidden">
              <div class="route-stat">
                <span class="route-stat-label">Distance</span>
                <span id="drive-route-distance" class="route-stat-value"
                  >--</span
                >
              </div>
              <div class="route-stat">
                <span class="route-stat-label">Est. Time</span>
                <span id="drive-route-time" class="route-stat-value">--</span>
              </div>
              <div class="route-stat">
                <span class="route-stat-label">Turns</span>
                <span id="drive-route-turns" class="route-stat-value">--</span>
              </div>
            </div>

            <!-- Simulation Display Options -->
            <div
              id="drive-display-options"
              class="drive-display-options hidden"
            >
              <label class="checkbox-label">
                <input type="checkbox" id="drive-map-view-checkbox" />
                <span class="checkbox-custom"></span>
                <span class="checkbox-text">Show map view (may be slower)</span>
              </label>
            </div>

            <!-- Navigation Controls -->
            <div id="drive-nav-controls" class="drive-nav-controls hidden">
              <button id="drive-start-btn" class="btn btn-primary btn-large">
                <span class="btn-icon">‚ñ∂</span>
                <span class="btn-text">Start Navigation</span>
              </button>
              <button
                id="drive-simulate-btn"
                class="btn btn-secondary btn-large"
              >
                <span class="btn-icon">‚è©</span>
                <span class="btn-text">Simulate</span>
              </button>
              <button
                id="drive-stop-btn"
                class="btn btn-danger btn-large hidden"
              >
                <span class="btn-icon">‚ñ†</span>
                <span class="btn-text">Stop</span>
              </button>
            </div>

            <!-- Navigation Status -->
            <div id="drive-nav-status" class="drive-nav-status hidden">
              <div class="nav-status-header">
                <span class="nav-state" id="drive-nav-state">Navigating</span>
              </div>
              <div class="nav-next-turn">
                <span class="turn-icon" id="drive-turn-icon">‚Üí</span>
                <span class="turn-distance" id="drive-turn-distance">--</span>
              </div>
              <div class="nav-instruction" id="drive-instruction">--</div>
              <div class="nav-progress">
                <div class="progress-bar">
                  <div
                    id="drive-progress-bar"
                    class="progress-fill"
                    style="width: 0%"
                  ></div>
                </div>
                <span class="nav-remaining" id="drive-remaining"
                  >-- remaining</span
                >
              </div>
            </div>
          </div>
        </section>

        <!-- Display Controls Panel -->
        <section class="panel-card hidden" id="display-controls-panel">
          <div class="section-header">
            <span class="section-marker">DISPLAY CONTROLS</span>
          </div>
          <div class="panel-content">
            <div class="zoom-control">
              <label class="control-label">
                Zoom Level
                <span class="zoom-badge" id="zoom-value">14</span>
              </label>
              <div class="zoom-slider-group">
                <button id="zoom-out-btn" class="zoom-btn">‚àí</button>
                <input
                  type="range"
                  id="zoom-control"
                  min="1"
                  max="20"
                  value="14"
                  class="zoom-slider"
                />
                <button id="zoom-in-btn" class="zoom-btn">+</button>
              </div>
            </div>

            <div class="action-buttons">
              <button id="refresh-btn" class="btn btn-primary btn-large">
                <span class="btn-icon">‚Üª</span>
                <span class="btn-text">Refresh Display</span>
              </button>
              <button id="clear-btn" class="btn btn-secondary">
                <span class="btn-icon">‚úï</span>
                <span class="btn-text">Clear</span>
              </button>
            </div>

            <div class="toggle-group">
              <label class="toggle-item">
                <input
                  type="checkbox"
                  id="auto-center"
                  checked
                  class="toggle-input"
                />
                <span class="toggle-switch"></span>
                <span class="toggle-label">Auto-center on GPS</span>
              </label>
              <label class="toggle-item">
                <input type="checkbox" id="auto-refresh" class="toggle-input" />
                <span class="toggle-switch"></span>
                <span class="toggle-label">Auto-refresh (5s)</span>
              </label>
            </div>

            <div class="orientation-control">
              <label class="control-label">Map Orientation</label>
              <button
                id="orientation-btn"
                class="btn btn-secondary orientation-btn"
              >
                <span class="orientation-icon">‚Üë</span>
                <span class="orientation-text">North Up</span>
              </button>
              <p class="control-hint">Tap to cycle: North Up ‚Üí Track Up</p>
            </div>
          </div>
        </section>

        <!-- WiFi Settings Panel -->
        <section class="panel-card hidden" id="wifi-settings-panel">
          <div class="section-header">
            <span class="section-marker">WIFI HOTSPOT</span>
          </div>
          <p class="panel-description">
            Configure the mobile hotspot your device will connect to.
          </p>
          <div class="panel-content">
            <div class="form-field">
              <label for="wifi-ssid" class="field-label"
                >Network Name (SSID)</label
              >
              <input
                type="text"
                id="wifi-ssid"
                class="field-input"
                placeholder="Enter hotspot name"
                maxlength="32"
              />
            </div>
            <div class="form-field">
              <label for="wifi-password" class="field-label">Password</label>
              <div class="password-field">
                <input
                  type="password"
                  id="wifi-password"
                  class="field-input"
                  placeholder="Min 8 characters"
                  minlength="8"
                />
                <button
                  type="button"
                  id="toggle-password"
                  class="password-toggle"
                >
                  Show
                </button>
              </div>
            </div>
            <div class="wifi-current">
              <span id="wifi-current-ssid">No hotspot configured</span>
            </div>
            <button id="save-wifi-btn" class="btn btn-primary btn-full">
              <span class="btn-icon">‚úì</span>
              Save Settings
            </button>
          </div>
        </section>

        <!-- Reset Panel -->
        <section class="panel-card hidden" id="reset-panel">
          <div class="section-header">
            <span class="section-marker">FACTORY RESET</span>
          </div>
          <div class="panel-content">
            <div class="warning-box">
              <div class="warning-icon">‚ö†</div>
              <div class="warning-text">
                <strong>Warning:</strong> This will reset all settings to their
                defaults, including:
                <ul>
                  <li>WiFi hotspot configuration</li>
                  <li>Display preferences</li>
                  <li>Zoom level and active track</li>
                  <li>Recent files list</li>
                </ul>
                The device will disconnect from WiFi and you may need to
                reconnect.
              </div>
            </div>
            <button id="reset-btn" class="btn btn-danger btn-full">
              <span class="btn-icon">‚Ü∫</span>
              Reset All Settings
            </button>
          </div>
        </section>

        <!-- Mock Display Panel -->
        <section class="panel-card hidden" id="mock-display-panel">
          <div class="section-header">
            <span class="section-marker">MOCK DISPLAY</span>
          </div>
          <div class="panel-content">
            <p class="mock-display-description">
              Live view of what would be displayed on the e-paper screen.
              Updates automatically when the display changes. Only available in
              development mode (mock e-paper service).
            </p>
            <div id="mock-display-container" class="mock-display-container">
              <div id="mock-display-status" class="mock-display-status">
                Checking availability...
              </div>
              <img
                id="mock-display-image"
                class="mock-display-image hidden"
                alt="Mock E-Paper Display"
              />
            </div>
            <div class="mock-display-actions">
              <button id="mock-display-refresh" class="btn btn-primary">
                <span class="btn-icon">‚Üª</span>
                Refresh
              </button>
            </div>
          </div>
        </section>
      </main>

      <!-- Connection Status -->
      <div class="connection-bar">
        <div id="connection-indicator" class="connection-status disconnected">
          <span class="connection-dot"></span>
          <span id="connection-text">Connecting...</span>
        </div>
      </div>

      <!-- System Messages Toast -->
      <div id="system-messages" class="toast-container">
        <div id="message-indicator" class="toast hidden">
          <span class="toast-icon"></span>
          <span id="message-text">System Message</span>
        </div>
      </div>

      <footer class="footer">
        <p>Papertrail GPS Tracker ¬© 2025</p>
      </footer>
    </div>

    <!-- Scripts -->
    <script src="/socket.io/socket.io.js"></script>
    <!-- Leaflet JS for drive navigation map -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="js/app.js"></script>
  </body>
</html>
